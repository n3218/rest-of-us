(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{216:function(e,t,a){"use strict";a.r(t);var l=a(0),s=a.n(l),o=a(13),n=a(2),r=a(6),u=a(3),c=a.n(u),i=a(14),d=a(15),m=a(12),v=a(11),p=a(23);t.default=Object(n.h)(e=>{const t=Object(l.useContext)(m.a),a=Object(l.useContext)(v.a),u={title:{value:"",hasErrors:!1,message:""},body:{value:"",hasErrors:!1,message:""},ifFetching:!0,isSeving:!1,id:Object(n.g)().id,sendCount:0,notFound:!1},[y,b]=Object(o.b)((e,t)=>{switch(t.type){case"fetchComplete":return e.title.value=t.value.title,e.body.value=t.value.body,void(e.isFetching=!1);case"titleChange":return e.title.hasErrors=!1,void(e.title.value=t.value);case"bodyChange":return e.body.hasErrors=!1,void(e.body.value=t.value);case"submitUpdates":return void(e.title.hasErrors||e.body.hasErrors||e.sendCount++);case"isSaving":case"saveRequestStarted":return void(e.isSaving=!0);case"saveRequestFinished":return void(e.isSaving=!1);case"titleRules":return void(t.value.trim()||(e.title.hasErrors=!0,e.title.message="Title should not be empty"));case"bodyRules":return void(t.value.trim()||(e.body.hasErrors=!0,e.body.message="Body of your post should not be empty"));case"notFound":return void(e.notFound=!0)}},u);if(Object(l.useEffect)(()=>{const l=c.a.CancelToken.source();return(async()=>{try{const s=await c.a.get("/post/"+y.id,{cancelToken:l.token});s.data?(b({type:"fetchComplete",value:s.data}),t.user.username!=s.data.author.username&&(a({type:"flashMessage",value:"You do not have permission to edit this post."}),e.history.push("/"))):b({type:"notFound"})}catch(e){console.log(e.response.data),console.log("...Or request was cancelled")}})(),()=>{l.cancel("Operation cancelled")}},[]),Object(l.useEffect)(()=>{if(y.sendCount){b({type:"saveRequestStarted"});const e=c.a.CancelToken.source();return(async()=>{try{const l=await c.a.post(`/post/${y.id}/edit`,{title:y.title.value,body:y.body.value,token:t.user.token},{cancelToken:e.token});console.log(l),b({type:"saveRequestFinished"}),a({type:"flashMessage",value:"Your post was successfully updated!"})}catch(e){console.log(e.response.data),console.log("...Or request was cancelled")}})(),()=>{e.cancel("Operation cancelled")}}},[y.sendCount]),y.notFound)return s.a.createElement(p.a,null);if(y.isFetching)return s.a.createElement(i.a,{title:"..."},s.a.createElement(d.a,null));return s.a.createElement(i.a,{title:"Edit Post"},s.a.createElement(r.b,{className:"small ",to:"/post/"+y.id},"Â« Back to post"),s.a.createElement("form",{className:"mt-2",onSubmit:e=>{e.preventDefault(),b({type:"titleRules",value:y.title.value}),b({type:"bodyRules",value:y.body.value}),b({type:"submitUpdates"})}},s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"post-title",className:"text-muted mb-1"},s.a.createElement("small",null,"Title")),s.a.createElement("input",{value:y.title.value,onBlur:e=>b({type:"titleRules",value:e.target.value}),onChange:e=>b({type:"titleChange",value:e.target.value}),autoFocus:!0,name:"title",id:"post-title",className:"form-control form-control-lg form-control-title",type:"text",placeholder:"",autoComplete:"off"}),y.title.hasErrors&&s.a.createElement("div",{className:"alert alert-danger small liveValidateMessage"},y.title.message)),s.a.createElement("div",{className:"form-group"},s.a.createElement("label",{htmlFor:"post-body",className:"text-muted mb-1 d-block"},s.a.createElement("small",null,"Body Content")),s.a.createElement("textarea",{value:y.body.value,onBlur:e=>b({type:"bodyRules",value:e.target.value}),onChange:e=>b({type:"bodyChange",value:e.target.value}),name:"body",id:"post-body",className:"body-content tall-textarea form-control",type:"text"}),y.body.hasErrors&&s.a.createElement("div",{className:"alert alert-danger small liveValidateMessage"},y.body.message)),s.a.createElement("button",{className:"btn btn-danger",disabled:y.isSaving},y.isSaving?"Saving...":"Save Updates")))})}}]);